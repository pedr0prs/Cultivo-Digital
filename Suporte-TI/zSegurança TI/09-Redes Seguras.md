# Práticas recomendadas para o fortalecimento de redes

O fortalecimento de redes é o processo de proteger uma rede por meio da redução de suas possíveis vulnerabilidades com mudanças de configuração e da execução de etapas específicas. Existe um princípio geral de segurança que pode ser aplicado à maioria das áreas de segurança: **é o conceito de desativar serviços extras desnecessários ou restringir o acesso a eles.**

Como qualquer serviço que é ativado e está acessível pode ser atacado, esse princípio também deve ser aplicado à segurança de rede. As redes seria muito mais seguras se os serviços de rede desnecessários fossem desativados e houvesse restrições de acesso. Negação implícita é um conceito de segurança de rede em que tudo que não for permitido explicitamente deve ser negado. E isso é diferente de bloquear todo o tráfego, já que um cenário com negação implícita ainda deixaria passar o tráfego definido como permitido, e é possível fazer isso com configurações Akhil.

Normalmente, essa configuração é feita no firewall, o que facilita a criação de regras de firewall seguras. Em vez de ter que bloquear especificamente todo o tráfego indesejado, basta você criar regras para o tráfego que quer deixar passar. Isso é como adicionar um item na lista de permissões, o oposto da lista de bloqueios. Enquanto seja um pouco menos conveniente, essa é uma configuração muito mais segura.

Antes de colocar um novo serviço em funcionamento, é preciso definir uma nova regra que reduza um pouco sua conveniência.

Outro componente muito importante da segurança de rede é monitorar e analisar o tráfego. Monitorar a rede é tão importante por alguns motivos. A primeira é que permite estabelecer um padrão para o que normalmente seria o tráfego da sua rede. Isso é essencial porque, para saber como é o tráfego incomum ou de ataque, você precisa saber como é o tráfego normal. E isso pode ser feito com o monitoramento do tráfego da rede e a análise de logs.

Analisar logs é a prática de coletar registros de diferentes redes e, em alguns casos, de dispositivos-cliente da rede e realizar uma análise automatizada neles. Esse processo vai isolar possíveis invasões, sinais de infecção por malware ou um comportamento parecido. O ideal é analisar logs de firewall, do servidor de autenticação e de aplicativos. Como especialista em suporte de TI. você deve prestar muita atenção em todos os dispositivos ou serviços externos. Eles têm muito mais chances de receber tráfego potencialmente malicioso, o que aumenta o risco de violação. A análise de logs envolve procurar mensagens específicas dos logs, como no caso dos logs de firewall.

Conexões da rede interna a faixas de endereço conhecidas por serem de servidores de comando e controle de botnet podem indicar que uma máquina da rede foi comprometida. E isso também vale para o fortalecimento de redes. Os sistemas de análise de logs são configurados com regras definidas pelo usuário para corresponder a entradas de registro comuns ou interessantes. Assim, elas podem ser expostas por meio de um sistema de alerta para que os engenheiros de segurança possam investigar. Parte desse processo de alerta também envolve categorizar o alerta com base na regra correspondida. Você também precisa atribuir prioridades para facilitar a investigação e permitir uma melhor pesquisa ou filtragem. Os alertas podem ser o envio de informações por e-mail ou SMS ou um link para o evento detectado. Você pode até acordar alguém no meio da noite se o evento for grave o suficiente.

Normalizar dados registrados em log é um passo importante porque os logs de diferentes dispositivos e sistemas podem não ser formatados de uma forma comum. Talvez seja preciso converter os componentes do log em um formato comum para facilitar o trabalho dos analistas e dos sistemas de detecção por regra. Isso também facilita a análise de correlação. A análise de correlação é o processo de obter dados de logs de diversos sistemas e eventos correspondentes nos sistemas. Então, se vemos uma conexão suspeita vindo de um endereço suspeito e dos logs do firewall para o nosso servidor de autenticação, talvez seja uma boa ideia correlacionar essa conexão registrada aos dados de log do servidor de autenticação. Assim, identificaríamos as tentativas de autenticação feitas pelo cliente suspeito. Esse tipo de análise de logs também é superimportante na investigação e recriação dos eventos ocorridos ao se detectar uma violação. Essa análise é comumente chamada de pós-falha, já que investiga o que aconteceu somente depois de detectar a violação. O registro detalhado e a análise de logs permitiria a reconstrução detalhada dos eventos que levaram à violação. A expectativa é que isso permita que a equipe de segurança faça alterações pontuais nos sistemas de segurança para evitar novos ataques. Esse método também ajuda a determinar a extensão e a gravidade da violação. O registro detalhado também poderia indicar se outros sistemas foram comprometidos após a violação inicial. Também nos diria se os dados foram ou não roubados, e se tiverem sido, quais eram.

Um sistema de análise de logs bem conhecido e poderoso é o Splunk, um sistema de agregação e pesquisa de logs muito flexível e extensível. O Splunk consegue capturar dados de logs de diversos sistemas e em muitos formatos diferentes. Ele também é capaz de gerar alertas e oferece uma visualização completa da atividade com base nos dados dos logs. As proteções contra inundação combatem ataques de Dos, ou negação de serviço.

Vamos voltar à tríade "CIA" que abordamos antes. "Disponibilidade" é um princípio de segurança importante, e as proteções contra inundação foram criadas para garantir exatamente isso. Elas identificam tipos comuns de ataques de inundação, como inundações SYN ou UDP. Depois, elas acionam alertas quando o limite de tráfego definido é atingido. Existe um outro limite chamado limite de ativação. Quando ele é atingido, uma ação pré-configurada é ativada. Normalmente, essa ação bloqueia o tráfego de ataque identificado por um período específico. Esse é um recurso comum de roteadores ou firewalls para empresas, embora seja um conceito geral de segurança.

Uma ferramenta comum de proteção contra inundação de código aberto é o Fail2Ban. Ela procura sinais de ataque a um sistema e bloqueia tentativas adicionais de um endereço de ataque suspeito. O Fail2Ban é uma ferramenta muito usada por empresas de pequeno porte. Esta proteção contra inundação também pode ser descrito como um tipo de sistema de prevenção de invasão.

A separação ou segmentação de redes é um princípio de segurança que, para especialistas de suporte de TI, vale a pena implementar. Ela cria uma gestão mais flexível da rede e oferece alguns benefícios de segurança. Esse é o conceito de usar VLANs para criar redes virtuais para diferentes classes ou tipos de dispositivo. Isso seria algo como criar redes virtuais dedicadas para os funcionários, mas também ter redes separadas para conectar impressoras. O objetivo é fazer com que as impressoras não precisem acessar os mesmos recursos de rede que os funcionários.

## Fortalecimento de Hardwares

Nosso foco será os recursos e opções disponíveis para hardware de infraestrutura de rede.
Então, você sabe que o DHCP é alvo de invasores por causa da importância do serviço que ele presta. Se um invasor conseguir implantar um servidor DHCP não autorizado na sua rede, ele pode distribuir as concessões de DHCP com as informações que quiser. E isso inclui a configuração de um endereço de gateway ou servidor DNS, que, na verdade, seria uma máquina sob controle dele. Com isso, ele conseguiria acessar seu tráfego e abrir a porta para futuros ataques. Chamamos esse tipo de ataque de DHCP intruso. Para se proteger contra esse ataque de servidor de DHCP intruso, os switches corporativos contam com um recurso chamado espionagem de DHCP.

**Um switch que tem espionagem de DHCP monitora o tráfego de DHCP que passa por ele. Além disso, ele também rastreia atribuições de IP e detecta os hosts conectados a portas do switch.** Com isso, cria-se um mapa de endereços IP atribuídos a portas físicas do switch. Essa informação também pode ser usada para proteger contra ataques de espionagem de IP e envenenamento ARP. A espionagem de DHCP também faz você designar o IP de servidor DHCP confiável, se estiver operando como um auxiliar de DHCP e encaminhando solicitações DHCP ao servidor, ou você pode ativar o `dhcp snooping trust` na porta de uplink, e é dela que passariam a vir as respostas DHCP legítimas. Toda resposta DHCP proveniente de um endereço IP não confiável ou de uma porta de downlink do switch seria identificada como não confiável e descartada pelo switch.

O ARP oferece uma camada para ataques de intermediário por conta da natureza não autenticada do ARP. Ele permite que um invasor falsifique uma resposta ARP anunciando seu endereço MAC como o endereço físico que corresponde ao endereço IP da vítima. Esse tipo de resposta ARP é chamado de resposta ARP gratuita, já que, na prática, responde a uma consulta que ninguém fez. Quando isso acontece, todos os clientes no segmento local da rede armazenariam essa entrada ARP em cache. Por conta da entrada ARP falsa, quadros direcionados ao endereço IP da vítima são enviados à máquina do invasor. O invasor pode ativar o encaminhamento de IP, o que permitiria monitorar de forma transparente o tráfego destinado à vítima. Além disso, ele pode manipular ou modificar dados. A inspeção dinâmica do ARP, ou DAI, é outro recurso de switches corporativos que impede esse tipo de ataque. A inspeção precisa da espionagem de DHCP para estabelecer um elo confiável de endereços IP para portas do switch. A DAI detecta esses pacotes ARP gratuitos falsificados e os ignora. Isso acontece porque ela tem uma tabela da espionagem de DHCP que possui as atribuições de endereço IP confiáveis por porta. A DAI também impõe uma grande limitação de pacotes ARP por porta para impedir a verificação de ARP. Um invasor provavelmente verificaria o ARP antes de tentar o ataque. Para evitar ataques de falsificação de IP, a proteção de origem dos IPs, ou IPSG, pode ser ativada em switches corporativos junto com a espionagem de DHCP.

Se você é especialista em suporte de TI de uma pequena empresa que usa hardware de switch corporativo, você provavelmente vai utilizar a IPSG. Ela opera usando uma tabela de espionagem DHCP para criar ACLs dinamicamente para cada painel de conexão. Isso faz com que pacotes que não correspondem ao endereço IP da porta, segundo a tabela de espionagem de DHCP, sejam descartados. Mas se você realmente quiser bloquear a rede, implemente o 802.1X. Esse é o padrão da IEEE para encapsular o tráfego EAP, ou protocolo de autenticação extensível, através das redes 802. Também é conhecido como EAP por LAN, ou EAPOL, e foi originalmente desenvolvido para Ethernet, mas recebeu suporte a outros tipos de rede, como redes Wi-Fi e de fibra.

Mas vamos entender melhor o EAP-TLS, que é um dos métodos EAP mais comuns e seguros. Quando um cliente deseja se autenticar em uma rede usando o 802.1X, são três elementos envolvidos. O dispositivo-cliente, que chamamos de suplicante. Às vezes, esse termo também é usado para se referir ao software em execução na máquina do cliente que gerencia o processo de autenticação do usuário.

O utilitário Linux de código aberto `wpa_supplicant` é um exemplo. O suplicante se comunica com o autenticador, que atua como uma espécie de "porteiro" para a rede. Ele exige que os clientes se autentiquem com sucesso na rede para permitir a comunicação nela. Esse elemento normalmente é um switch corporativo ou um ponto de acesso, no caso de redes sem fio. É importante dizer que, embora o suplicante se comunique com o autenticador, na verdade, não é o autenticador que decide sobre a autenticação. O autenticador age como um intermediário e encaminha a solicitação de autenticação ao servidor de autenticação. É aí que a verificação e a autenticação de credenciais acontece.

O servidor de autenticação é geralmente um servidor RADIUS. EAP-TLS é um tipo de autenticação compatível com EAP que usa TLS para fornecer autenticação mútua do cliente e do servidor de autenticação. Essa é considerada uma das configurações mais seguras para conexões sem fio, então, provavelmente você verá esse tipo de autenticação na sua carreira em TI.

### Fortalecimento dos softwares de rede

É importante que você saiba implementar o fortalecimento de software de rede, que envolve firewalls, proxies e VPNs, por exemplo. Essas soluções de segurança desempenham um papel importante na proteção de redes e o tráfego na organização. Como mencionamos antes, os firewalls são essenciais para proteger uma rede. Eles podem ser implementados como dispositivos de infraestrutura de rede dedicados, que regulam o tráfego de toda a rede. Eles também podem ser de host na forma de software executado em um sistema-cliente que oferece proteção apenas para esse host.

Geralmente, o recomendado é usar as duas soluções. Um firewall baseado em host protege dispositivos móveis, como notebooks, que poderia ser usado em um ambiente desprotegido e possivelmente malicioso, como um hotspot Wi-Fi de aeroporto. Firewalls de host também são úteis para impedir que outros hosts sejam violados por um dispositivo corrompido na rede interna. Um firewall de rede pode não conseguir ajudar na defesa contra esse tipo de problema. Quase com certeza você encontrará firewalls de host, já que todos os principais sistemas operacionais vêm com essa ferramenta. Também é muito provável que sua empresa tenha algum tipo de firewall de rede. Até o roteador da sua casa tem um firewall de rede integrado. VPNs também são recomendáveis para dar acesso seguro a recursos internos para usuários mobile ou em roaming.

As VPNs são muito usadas para fornecer acesso remoto seguro e conectar duas redes com segurança. Normalmente, a mesma infraestrutura pode ser usada para disponibilizar serviços de VPN de acesso remoto a cada cliente que precisa acessar  recursos internos de fora do escritório.

Os proxies podem ser muito úteis para proteger os dispositivos-cliente e seu tráfego. Além disso, eles fornecem acesso remoto seguro sem usar VPN.

Um proxy Web padrão pode ser configurado para dispositivos-cliente. Ele faz com que o tráfego Web seja intermediado por proxy por um servidor proxy que controlamos por muitos motivos. Essa configuração pode ser usada para registrar solicitações Web de dispositivos-cliente. Os dispositivos podem ser usados para análise de logs e tráfego e investigação forense. O servidor proxy pode ser configurado para bloquear conteúdo que possa ser malicioso, perigoso, ou que apenas descumpra a política da empresa. É possível configurar um proxy reverso para permitir o acesso remoto seguro a serviços Web sem precisar de uma VPN. Mas, para um especialista em suporte de TI, talvez seja necessário configurar ou ter um serviço de proxy reverso como alternativa à VPN.

Ao configurar um proxy reverso na borda da rede, as solicitações de conexão que vêm de fora a serviços da rede são interceptadas pelo proxy reverso. Depois, elas são encaminhadas para o serviço interno, com o proxy reverso agindo como um relê. Isso cria a comunicação entre o cliente remoto fora da rede e o serviço interno. Essa configuração de proxy pode ter ainda mais proteção com a exigência de certificados TLS do cliente, além da autenticação com nome de usuário e senha. Alem disso, é possível configurar ACLs específicas no proxy reverso para restringir ainda mais o acesso. Muitas soluções de proxy bem conhecidas oferecem configuração de proxy reverso, como o HAProxy, o Nginx e até o Apache Web Server.
