# Praticas recomendadas

Vamos falar dos três A's da **segurança, autenticação, autorização e registros (accounting).**
Você pode pensar em segurança como mitigação de riscos, e quando se trata de mitigação de riscos, é impossível eliminar completamente os riscos. O máximo que você pode fazer é entender os riscos que seus sistemas enfrentam, tomar medidas para reduzir esses riscos e monitorá-los.

Pense da seguinte forma: o sistema de computador mais seguro é aquele que está desconectado de tudo, inclusive das redes e da energia elétrica, e está trancado em um bunker de concreto a centenas de metros de profundidade, onde ninguém tem acesso. Embora esta máquina esteja incrivelmente segura, quase impossível de fragilizar, ela é inútil porque está desligada e ninguém consegue acessá-la. Este é um exemplo extremo de contraponto entre segurança e usabilidade, mas dá para entender.

Como especialista em suporte de TI, garantir que sua empresa use senhas e práticas fortes e use recomendações para senhas é muito importante. Essas são as chaves do sucesso. Incorporar boas políticas de senhas na empresa é fundamental para garantir que os funcionários estejam protegendo suas contas com senhas fortes. Um bom sistema de diretrizes de senhas com requisitos de tamanho, complexidade de caracteres e ausência de palavras dicionarizadas aumenta a força das senhas. As senhas nunca devem ser escritas ou salvas em texto simples, reutilizadas em várias contas nem compartilhadas com ninguém. A reutilização de senha é um risco porque se a senha de uma conta for descoberta, as outras contas com a mesma senha também correrão risco. O compartilhamento de senhas também deve ser proibido, pois isso prejudica a identidade de uma conta, já que outra pessoa consegue fazer login como esse usuário.

Além de exigir o uso de senhas fortes, uma política de rotação de senhas também é recomendada, uma vez que ela protege contra possíveis senhas descobertas, mas não detectadas. Mas é importante que o período de rotação de senhas não seja muito curto. O transtorno de ter que mudar a senha muitas vezes pode motivar um comportamento de segurança insatisfatório pelos usuários. Então, digamos que você exija que sua organização crie senhas muito complexas e as altere a cada três meses. É muito provável que grande parte dos usuários escreva suas senhas em bilhetes ou nos telefones. Nada seguro. Apesar de a política ser destinada a aumentar a segurança, ela passa a ter o efeito oposto por causa do transtorno causado aos usuários.

## Autenticação multifator

Na autenticação multifatorial, os usuários apresentam diversos elementos de informação, ou objetos, para se autenticar. Os vários fatores que compõem um sistema de autenticação multifatorial subdividem-se em três tipos: **algo que você sabe, algo que você tem e algo que você é.**

O ideal é o sistema incorporar pelo menos dois desses tipos. Algo que você sabe seria, por exemplo, uma senha ou o PIN de seu cartão de débito. Algo que você tem seria algo físico, como o seu cartão em si. Algo que você é envolve dados biométricos, como digitais ou mapeamento da íris.

A premissa por trás da autenticação multifator é que, para um invasor, é bem mais difícil roubar ou clonar múltiplos tipos de fatores de autenticação ao mesmo tempo. Usar mais de uma senha não aumenta tanto assim a segurança, pois todas as senhas são suscetíveis ao phishing e ao keylogging. No entanto, usar uma senha com um token de segurança muda o jogo. Se a senha for comprometida por meio de phishing, o invasor também precisaria roubar ou clonar o token físico para acessar a conta, algo muito mais difícil de acontecer.

Resumidamente falando, há diversos tipos diferentes de tokens físicos. Muito comuns são os dispositivos USB com tokens secretos, os dispositivos geradores de tokens e até mesmo chaves e fechaduras convencionais. Um tipo bem comum token físico gera um token de curta duração, geralmente um número para inserir junto com o nome de usuário e a senha. Por ter curta duração e sempre mudar de valor, esse número costuma ser chamado de senha descartável, ou OTP.

Um exemplo é o RSA SecurID, um aparelhinho a bateria com um visor LCD que mostra uma senha que se alterna periodicamente. É um token temporal, também denominado TOTP. Ele utiliza uma chave secreta ou gera um valor aleatório para ser registrado no servidor de autenticação. O valor da chave é utilizado junto com o horário atual para gerar a senha descartável. O usuário tem que ter o token em mãos ou poder vê-lo no visor para poder fazer o login.

Vale ressaltar que esse método requer uma sincronização entre os horários do servidor e do token, geralmente feita com o NTP, o protocolo de horário da rede. Portanto, para obter o valor da chave secreta, o invasor precisaria clonar o token ou roubar o dispositivo. Como os horários do token temporal e do servidor são sincronizados, e o horário não é secreto, bastaria verificá-lo para clonar o token. Também há os tokens de contador, que usam uma chave secreta e um contador cujo valor se incrementa toda vez que uma senha descartável é gerada. Esse valor é também incrementado no servidor quando a autenticação dá certo. Eles são mais seguros que os tokens temporais por duas razões:

- **Primeiro:** o invasor precisa obter tanto o valor da chave quanto o do contador.
- **Segundo:** o valor do contador se incrementa sempre que é utilizado.

Portanto, um token clonado só pode ser utilizado por bem pouco tempo antes do valor do contador se alterar demais e o token clonado ficar sem sincronia com o token real e o servidor. Os tokens podem ser gerados por dispositivos físicos dedicados ou por um aplicativo instalado em um smartphone.

Outro método multifatorial muito comum hoje em dia é a entrega das senhas descartáveis por SMS. No entanto, esse método tem sido criticado por conta de alguns ataques que foram observados. O problema de transmitir um fator adicional por SMS é que você acaba dependendo dos procedimentos de segurança da operadora do celular. O SMS não tem criptografia, nem privacidade. Ele também pode ser interceptado por uma pessoa endinheirada. E pior: há casos de códigos de SMS sendo roubados com meras ligações à provedora de telefonia, Com o invasor se apresentando como o dono da linha para redirecionar chamadas e SMSs para um dispositivo que esteja em suas mãos. Se o invasor já tiver a senha e conseguir redirecionar o SMS para si, obterá total acesso à conta.

No entanto, os tokens físicos têm uma desvantagem: você precisa carregar um dispositivo a mais para se autenticar. Se ele for perdido ou danificado, você terá que substituí-lo para poder se autenticar novamente. Eles também precisam de mais suporte, pois podem parar de funcionar, ser perdidos, ficar sem sincronia com o servidor ou sem bateria. Os aplicativos de smartphone eliminam alguns desses problemas, mas ainda têm algumas complicações. Na hora de fazer o login, o usuário tem que tirar o dispositivo do bolso para transcrever os números na página de login.

Além disso, as senhas descartáveis podem sofrer ataques do tipo "man-in-the-middle". Ou seja, o usuário pode receber um email malicioso que leva para uma página de login falsa. A mensagem pode ser algo como "sua conta foi comprometida, faça o login e mude sua senha agora mesmo". Se a vítima inserir suas credenciais na página falsa, junto com a senha descartável, o atacante obterá todas as informações necessárias para roubar a conta.

O terceiro tipo de autenticação multifatorial é o biométrico, que ganhou popularidade nos últimos anos, sobretudo nos dispositivos móveis. A autenticação biométrica utiliza características físicas exclusivas da pessoa para identificá-la. Com a assinatura biométrica confirmada, a pessoa é autenticada. Ela é muito usada para destravar dispositivos móveis com o uso de impressões digitais. Isso se faz com um sensor ótico que captura imagens das impressões digitais de uma pessoa. Assim como as senhas não devem ser armazenadas como texto simples, os dados biométricos também não devem ser armazenados diretamente. Isto é ainda mais importante com os dados biométricos, pois, ao contrário das senhas, eles são algo inerente à própria pessoa. O roubo ou vazamento de dados biométricos são grandes problemas de privacidade. Ao contrário das senhas, as características biométricas são dificílimas de alterar se o sistema for comprometido.

Portanto, em vez de ser armazenada diretamente, a impressão digital passa por um algoritmo de hashing e só o hash é armazenado. Uma vantagem da biometria sobre os sistemas de token ou de conhecimento é a maior precisão na identificação e autenticação de pessoas, pois os traços biométricos costumam ser intransferíveis. É impossível, por exemplo, repassar suas digitais para um amigo se autenticar por você. Ou pelo menos deveria ser assim. Com as escolas usando mais e mais as digitais para controlar a presença dos alunos, eles encontraram maneiras de enganar o sistema.

A Microsoft desenvolveu uma autenticação biométrica para o Windows 10, o Windows Hello, que tem suporte para leitura de digitais, identificação da íris e reconhecimento facial. Ele usa duas câmeras, uma para cor e outra para infravermelho, detectando assim a profundidade. Isso impede que alguém use fotos de pessoas credenciadas para enganar o sistema.

Uma evolução dos tokens físicos é o U2F, ou Universal Second Factor. Ele foi desenvolvido em conjunto pelo Google, a Yubico e a NXP Semiconductors. O padrão pronto do U2F está sendo hospedado pela aliança FIDO. O U2F incorpora um mecanismo de desafio-resposta, com criptografia de chave pública, para proporcionar uma autenticação de dois fatores mais segura e prática. Os tokens U2F são denominados chaves de segurança e são produzidos por vários fabricantes.

Os navegadores Chrome e Opera têm suporte integrado à autenticação U2F, com suporte nativo chegando em breve ao Firefox. As chaves de segurança são pequenos criptoprocessadores embutidos que armazenam chaves assimétricas com segurança e têm slots para código embutido.

Da perspectiva da segurança, esse processo é muito superior às OTPs, pois sua interatividade protege o fluxo de autenticação contra o phishing. Como o U2F não protege diretamente contra o "man-in-the-middle", a autenticação deve ser feita em uma conexão TLS segura para evitar ataques desse tipo. É muito difícil forjar ou clonar chaves de segurança, pois elas têm dados secretos embutidos que as protegem contra adulterações. Quanto à usabilidade, o fluxo autenticatório é muito melhor que o das OTPs, pois o usuário não precisa digitar uma sequência numérica na janela de autenticação, mas só usar a chave de segurança.

### Certificados

Já sabemos que os certificados são chaves públicas assinadas por uma CA, ou autoridade de certificação. Vimos sobre os certificados de servidor TLS, mas também há certificados de cliente. O funcionamento deles é muito parecido do dos de servidor, mas são os  clientes que os apresentam para os servidores autenticá-los e verificá-los. Todo especialista em suporte de TI tem que saber muito bem sobre os certificados de cliente e a autenticação por certificados, pois podem se deparar com eles em suas carreiras. Em sistemas Wi-Fi de empresas e em VPNs, a autenticação por certificados de cliente não é algo raro.

Portanto, saber como eles funcionam ajuda a resolver problemas. Para emitir certificados de cliente, a entidade tem que configurar e manter uma infraestrutura para emitir e assinar certificados. Para o certificado ser autenticado, o cliente também tem que autenticar o servidor – a autenticação é mútua. Isso é bom, pois o cliente pode conferir se está se comunicando com o servidor de autenticação correto. Todos os clientes que usam autenticação por certificado também precisam ter o certificado da CA entre seus certificados confiáveis. Isso estabelece a confiabilidade da CA e, na autenticação, o cliente pode ver se está se comunicando com o servidor correto.

A autenticação por certificado é como se identificar no aeroporto. Você mostra um documento para provar quem você é. O verificador então o analisa para ver se foi emitido por uma autoridade confiável. Ele foi mesmo emitido por um país ou é só um cartãozinho qualquer? Tem uma série de documentos que o verificador aceita, assim como os certificados de CAs confiáveis são aceitos na TI. No aeroporto, eles também conferem a data de validade do documento. O mesmo se aplica aos certificados de autenticação, que têm duas datas para serem verificadas, uma de ínicio e outra de término da validade. A data de início define quando o certificado se torna válido. É possível emitir certificados para serem usados só no futuro. A data de término é como um prazo de validade convencional, definindo quando o certificado perde a validade. No aeroporto, as autoridades têm uma lista de pessoas que não aceitam. Se o seu nome estiver na lista, você não pode embarcar. Da mesma forma, o certificado não pode estar na lista de revogação, ou CRL. A CRL é uma lista assinada e publicada pela CA que diz quais certificados foram explicitamente revogados.

Por fim, na verificação do servidor de autenticação, é necessário provar ter a chave privada correspondente, pois o certificado é uma chave pública assinada. Como esse certificado não é secreto, sem essa prova o invasor poderia simplesmente copiar o certificado fingindo ser o seu dono. Por causa disso, utiliza-se um mecanismo de desafio-resposta para provar a posse da chave privada. Ou seja, o servidor solicita uma quantidade de dados assinada com a chave privada correspondente à chave pública apresentada na autenticação. Da mesma forma, no aeroporto, eles olham a foto do seu documento para ver se você é mesmo a pessoa da foto, e não um impostor.

#### LDAP

LDAP, ou protocolo leve de acesso a diretórios, é um protocolo padrão da indústria para acessar e manter serviços de diretório. É mais usado como um backend para a autenticação de contas. A especificação LDAP descreve a estrutura de dados do próprio diretório e define funções para interagir com o serviço, como realizar pesquisas e modificar dados.

O diretório é uma espécie de banco de dados, mas com mais detalhes ou atributos, que descrevem as entidades dentro do banco de dados. A estrutura de um diretório LDAP é um tipo de layout de árvore e é otimizada mais para a recuperação de dados do que para gravação. É como se fosse uma lista telefónica utilizada para procurar dados mais frequentemente do que fazer modificações nesses dados. Os diretórios podem ser hospedados em vários servidores LDAP para facilitar pesquisas mais rápidas, sendo mantidos em sincronia por meio de replicação do diretório.

Como o LDAP usa uma estrutura de árvore chamada de **árvore de informações de dados**, os objetos tem um pai e podem ter um ou mais filhos que pertencem ao objeto pai. Também é possível enxergar isso como um sistema de arquivos com um sistema de arquivos raiz com várias pastas abaixo. A pasta à qual um objeto pertence apresenta informações sobre esse objeto por causa de sua relação com o objeto pai. Na linguagem LDAP, chamamos essas pastas de unidades organizacionais, ou UOs. Elas nos permitem agrupar objetos relacionados em unidades como pessoas ou grupos a fim de distinguirmos entre contas de usuários individuais e grupos aos quais as contas podem pertencer.

Esta estrutura de árvore também permite a herança e o aninhamento de objetos, onde os atributos ou as propriedades de um objeto pai podem ser herdados pes filhos que estão mais abaixo na árvore. Agora, já que as entradas do diretório podem compartilhar atributos, deve haver um identificador exclusivo para cada entrada. Chamamos isso de DN, ou nome distinto. Voltando à nossa analogia ao sistema de arquivos, você pode pensar em um DN como um caminho completo para um arquivo, diferentemente do nome de arquivo. Isso porque você pode ter múltiplos arquivos com o mesmo nome de arquivo em um sistema de arquivos. Mas o caminho completo para o arquivo aponta para um arquivo exclusivo. Algumas das operações mais comuns que podem ser chamadas por um cliente para interagir com um servidor LDAP são "Bind", que é a forma como os clientes se autenticam no servidor. StartTLS, que permite que um cliente se comunique usando LDAP v3 por TLS. Search, para realizar pesquisas e recuperações de registros. Add/Delete/Modify, que são várias operações para gravar dados no diretório. Unbind, que encerra a conexão com o servidor LDAP. Existem muitas implementações de servidores LDAP, como o Active Directory da Microsoft e o OpenLDAP para implementações de código aberto.

##### RADIUS

RADIUS, ou serviço de usuário com discagem para autenticação remota, é um protocolo que fornece serviços AAA para os usuários de uma rede. É um protocolo muito comum usado para gerenciar o acesso a redes internas, redes WiFi, serviços de e-mail e serviços VPN. Originalmente projetado para transportar informações de autenticação para usuários remotos dial-up, evoluiu para transportar uma ampla variedade de protocolos de autenticação padrão, como o EAP, protocolo de autenticação extensível.

Embora seja improvável que você se responsabilize pela configuração de um servidor RADIUS enquanto especialista em suporte de TI, você pode prestar suporte para clientes que se autenticam em um servidor back-end RADIUS. Nesses casos, é bom entender qual função o servidor RADIUS desempenha neste cenário de autenticação para que você esteja preparado para solucionar problemas que possam surgir. Os clientes que desejam se autenticar em um servidor RADIUS não interagem diretamente com o servidor. Em vez disso, quando o cliente deseja acessar um recurso protegido, o cliente apresenta as credenciais de autenticação para um NAS, ou servidor de acesso à rede, que retransmite as credenciais para o servidor RADIUS.

O servidor RADIUS verifica as credenciais usando um esquema de autenticação configurado. Os servidores RADIUS podem verificar as informações de autenticação do usuário armazenadas em um arquivo simples ou podem se conectar a fontes externas, como bancos de dados SQL, LDAP, Kerberos ou Active Directory. Depois que o servidor RADIUS avalia a solicitação de autenticação do usuário, ele responde com uma das três mensagens: rejeitar acesso, desafiar acesso ou aceitar acesso.

###### Kerberos

O Kerberos é um protocolo de autenticação de rede que usa tickets para permitir que as entidades comprovem sua identidade em canais potencialmente inseguros a fim de oferecer autenticação mútua. Ele também usa criptografia simétrica para proteger mensagens de protocolo contra espionagem e ataques repetitivos.

O Kerberos recebeu algumas críticas por ser um serviço monolítico único. Isso gera um ponto único de risco de falhas. Se o serviço Kerberos cair, novos usuários não poderão se autenticar e fazer login. Além dos problemas de disponibilidade, se o servidor central Kerberos tiver algum problema, o invasor pode se passar por qualquer usuário gerando tickets válidos do Kerberos para a conta de usuário. O Kerberos impõe requisitos rigorosos de hora que exigem que os relógios do cliente e do servidor destejam relativamente sincronizados, caso contrário, a autenticação falha.

Geralmente se usa o NTP para manter ambas as partes sincronizadas, usando-se um servidor NTP. O modelo de confiança do Kerberos também é problemático, pois ele exige que os clientes e serviços tenham confiança estabelecida no servidor Kerberos para autenticar usando esse sistema. Isso significa que não é possível que os usuários se autentiquem usando o Kerberos a partir de clientes desconhecidos ou não confiáveis.

###### TACACS+

TACACS+, pronunciado "TACACS Plus", significa sistema de controle de acesso com controlador de acesso terminal. Trata-se um protocolo AAA desenvolvido pela Cisco, que foi lançado como padrão aberto em 1993. Substituiu o antigo protocolo TACACS desenvolvido em 1984 para o MILNET, rede não classificada para a DARPA, que depois evoluiu para a NIPRNet. O TACACS+ também tomou o lugar do XTACACS ou TACACS estendido, que era uma extensão proprietária da Cisco acima do TACACS. O TACACS+ é usado principalmente para administração, autenticação, autorização e registros de dispositivos, diferentemente do RADIUS, que é usado principalmente para acesso à rede AAA.

É importante chamar a atenção para essas diferenças nas características dos serviços fornecidos. Embora as diferenças estejam relacionadas principalmente à autorização e ao registro, mais do que à autenticação. Embora você possa não encontrar uma implementação do TACACS+ no decorrer da sua carreira de suporte, é algo que você deve saber que existe. O TACACS+ é usado principalmente como sistema de autenticação para dispositivos de infraestrutura de rede que tendem a ser alvos de alto valor para invasores. Você pode considerar sua implementação à medida que sua organização for crescendo.

###### Login unico

Na autenticação única, ou SSO, o usuário só precisa se autenticar uma vez para obter acesso a uma variedade de serviços e aplicativos. Sem ter que se reautenticar em cada serviço, os usuários não precisam usar uma senha e nome de usuário para cada serviço ou aplicativo. A autenticação é feita com o uso do cadastro de um servidor central, que pode ser um servidor LDAP. Ele fornece um cookie ou token para dar acesso a aplicativos que foram configurados para usar o SSO.

O Kerberos é um bom exemplo de serviço de autenticação de SSO. O usuário só precisa se autenticar uma vez no Kerberos para obter um tíquete que concede tíquetes. Esse tíquete pode substituir as credenciais convencionais para se autenticar em algum serviço. Ou seja, o usuário apresenta suas credenciais uma só vez e obtém acesso a vários serviços. O SSO é muito prático. Ele permite acessar vários serviços com uma credencial só, desincentivando o armazenamento inseguro ou por escrito de senhas. Ele também diminui a necessidade de suporte técnico para senhas e, nas empresas, elimina o gasto de tempo com reautenticações.

O problema é que, em um sistema SSO, um invasor pode acabar obtendo um acesso muito amplo. As credenciais do usuário dão acesso a todos os aplicativos e serviços que a conta pode acessar. É por isso que se utiliza a autenticação multifatorial nos esquemas de SSO, o que abre uma brecha para o roubo de cookies ou tokens da sessão SSO. Em vez de visar as credenciais em si, o invasor pode tentar roubar os tokens da SSO, pois isso proporciona um acesso bem amplo, mesmo que temporário. Ao roubar os tokens, o invasor também se desvencilha das proteções da autenticação multifatorial, pois, antes de expirar, o token da sessão dá acesso sem a pessoa ter que se autenticar por completo.

Um exemplo de sistema SSO é o openID, o sistema de autenticação centralizado. Ele é um padrão aberto que permite que os sites participantes autentiquem seus usuários com um serviço de autenticação externo. Com isso, os sites não precisam uma infraestrutura própria para realizar a autenticação, e pode ser difícil implantar e manter essa infraestrutura. Com isso, os usuários não precisam criar mais uma conta para acessar o site, simplificando assim a gestão de acesso para vários sites. O usuário só precisa ter uma conta em um provedor de identificação. Para confirmar a identidade, o site participante consulta o provedor openID e eles criam uma senha para usarem entre si, se ela ainda não existir. Essa senha é utilizada para validar as mensagens do provedor openID. Depois disso, o usuário é redirecionado ou aparece uma nova janela para o usuário se autenticar com os registros do provedor. Depois de autenticado, o usuário tem que confirmar se confia ou não no site participante. Com a confirmação, as credenciais são repassadas ao site, geralmente como um token e não na forma das credenciais em si, para indicar que o usuário está autenticado para usar o serviço.
