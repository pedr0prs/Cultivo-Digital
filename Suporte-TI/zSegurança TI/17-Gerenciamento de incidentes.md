# Relatório e análise de incidentes

Independentemente da natureza do incidente, o gerenciamento adequado dos incidentes é importante para entender o que aconteceu, como aconteceu e como evitar que volte a acontecer. **O primeiro passo para atuar em um incidente é detectá-lo.** Se tivermos sorte, nossos sistemas de detecção de invasão capturaram sinais que revelaram um ataque em movimento e nos alertaram da ameaça. Os incidentes podem ser levados ao seu conhecimento de outras formas também.

Um funcionário pode perceber algo suspeito informar à equipe de segurança para investigação ou talvez vaze informações que acabaram nos noticiários. De qualquer forma, você ficou sabendo do incidente. O próximo passo é analisar o incidente e determinar os efeitos e a área do dano. Foi um vazamento de dados? Uma divulgação de informações? Se sim, que informações foram divulgadas? É muito grave? Os sistemas foram comprometidos? Quais sistemas? E que nível de acesso o invasor obteve? É uma infecção por malware? Quais sistemas foram infectados? Alguns ataques são bem óbvios e dão sinais muito claros de invasão, como uma página web toda desfigurada ou processo incomum que consome todos os recursos do sistema. Outros podem ser muito mais sutis e quase impossíveis de detectar, como uma pequena alteração em um único arquivo de configuração do sistema.

É por isso que é tão importante ter uma boa estrutura de monitoramento, além de conhecer seus padrões de tráfego. Quando descobrir como seu tráfego normalmente se comporta na rede e que serviços são esperados, fica mais fácil identificar os casos atípicos. Isso é importante porque cada pista falsa que a equipe de resposta a incidentes investiga significa tempo e recursos gastos. Isso cria um ambiente para que invasões reais passem despercebidas e não investigadas por mais tempo. Na detecção e definição de escopo, correlacionar dados de diferentes sistemas pode gerar uma visualização muito mais profunda do que aconteceu. Pode mostrar como um invasor obteve acesso. Por exemplo, talvez você encontre um evento de conexão registrado pelo firewall vindo de um endereço IP suspeito. Procurar outros eventos relacionados a esse endereço IP pode revelar tentativas de acesso e os logs de autenticação de um sistema. Isso daria uma ideia da localização do invasor e do que ele tentou fazer na rede. Os logs de autenticação também indicariam se ele conseguiu ou não acessar uma conta. Se sim, você poderá ver qual conta foi comprometida.

Depois de determinar a área do incidente, o próximo passo é a contenção. Você precisa conter a violação para evitar mais danos. Para violações de sistema e infecção por malware, esse é um passo que precisa de rapidez. Não é uma boa ideia deixar o malware ou o invasor usar uma máquina comprometida para acessar outras máquinas dentro da sua rede. Isso pode ampliar a área de incidência e causar ainda mais danos. As estratégias de contenção variam de acordo com a natureza do incidente. Se uma conta foi violada, você tem que mudar a senha imediatamente. Se o proprietário não puder alterar a senha imediatamente, você tem que bloquear a conta. Além disso, revogue todos os tokens de autenticação de longa duração, já que o invasor pode ter acesso a um deles.

Se for uma infecção por malware, nosso software antimalware pode colocar a infecção em quarentena ou removê-la? Se não puder, a máquina infectada terá que ser removida da rede o quanto antes para impedir a difusão do ataque na rede. Para fazer isso, você pode ajustar as regras do firewall de rede para colocar a máquina em quarentena. Você também pode levar a máquina para uma VLAN isolada usada para quarentena de segurança. Essa seria uma VLAN com restrições rígidas e filtragem aplicada para a prevenção de novas infecções de outros sistemas e redes. Durante esta fase, é importante ter foco total para evitar a destruição de logs ou evidência forense.

Os invasores geralmente tentam cobrir seus rastros modificando logs e excluindo arquivos, especialmente quando acreditam que foram pegos. Eles farão o que for preciso para tentar manter o acesso aos sistemas comprometidos. Isso pode envolver a instalação de uma backdoor ou algum tipo de malware de acesso remoto.

Outra ação a observar é a criação de uma nova conta de usuário que ele possa usar para se autenticar no futuro. Com configurações e sistemas de registro eficazes, essas atividades apareceriam nos logs de auditoria. Portanto, esse tipo de acesso deve ser detectado em uma investigação do incidente para a partir disso remover esse acesso.

Outra parte da análise de incidentes é determinar a gravidade, o impacto e a capacidade de recuperação do incidente. A gravidade envolve fatores como quais e quantos sistemas foram comprometidos e como a violação afeta as funções da empresa. Um incidente que comprometesse diversas máquinas na rede seria mais grave do que uma invasão a um único servidor web, por exemplo. Você já deve imaginar que o esforço necessário para eliminar uma violação de grande escala afetaria negativamente a capacidade de trabalhar normalmente.

**Por isso, o impacto de um incidente também é um ponto importante a considerar. Se a organização tivesse apenas um servidor web e ele fosse comprometido, essa pode ser considerada uma falha de segurança muito mais grave. O impacto nos negócios provavelmente seria direto e perceptível externamente. A exfiltração de dados é a transferência não autorizada de dados de um computador. É também um ponto muito relevante quando um incidente de segurança ocorre.**

Os hackers tentam roubar dados por vários motivos. Talvez queiram informações da conta para ter acesso a ela mais tarde. Talvez visem dados corporativos para publicar on-line e causar prejuízo financeiro ou danos à reputação da empresa. Em alguns casos, o invasor só quer causar danos e destruição, e isso pode envolver a exclusão ou a corrupção de dados. A capacidade de recuperação é o nível de complexidade e de tempo necessário para realizar a recuperação.

Um incidente que pode ser recuperado com uma simples restauração de backup seguindo procedimentos documentados seria considerado facilmente recuperável. Mas um incidente em que um invasor excluiu grandes quantidades de informações de clientes e provocou o caos em muitos sistemas críticos de infraestrutura teria uma recuperação muito mais difícil. E pode até ser impossível recuperar. Em alguns casos, dependendo dos sistemas e das configurações de backup, alguns dados podem ser perdidos para sempre e nunca mais poderem ser restaurados. Os backups não contêm alterações ou dados que vieram depois do último backup realizado.

## Resposta e recuperação de incidentes

Ao se detectar e conter uma ameaça, é preciso removê-la ou corrigi-la. Em infecções por malware, isso significa remover o malware dos sistemas afetados. Mas em alguns casos, isso não é possível, portanto, é preciso restaurar os sistemas afetados para uma boa configuração conhecida. Isso pode ser feito com a remontagem da máquina ou a restauração de backup. Tome cuidado ao remover malwares de sistemas porque alguns são desenvolvidos para persistir, sendo resistentes a remoção. Mas antes de começarmos a recuperação, temos que conter o incidente. Isso pode envolver desligar sistemas afetados para evitar mais danos ou a propagação da infecção.

Por outro lado, os sistemas afetados podem ter o acesso à rede removido para impedir qualquer comunicação com o sistema comprometido. Mais uma vez, o motivo seria prevenir a propagação da infecção ou remover o acesso remoto ao sistema. A estratégia de contenção varia de acordo com a natureza do sistema afetado. Digamos que uma parte crítica da infraestrutura de rede foi comprometida. Um desligamento rápido pode não funcionar, já que impactaria outras operações comerciais. Além disso, a remoção do acesso à rede pode criar falhas de segurança a ataques de software ou malware. Digamos que um malware tenha como objetivo verificar periodicamente um servidor de comando e controle.

Cortar as comunicações de rede com o host infectado pode fazer o malware acionar uma função de autodestruição em uma tentativa de destruir provas. Pode ser necessário fazer uma análise forense para entender o ataque. Principalmente quando se trata de uma infecção por malware. No caso da análise forense, máquinas afetadas são investigadas atentamente para se determinar exatamente o que o invasor fez. Essa análise geralmente ocorre com uma cópia virtual da imagem do disco rígido. Isso permite ao investigador analisar o conteúdo do disco sem correr o risco de modificar ou alterar os arquivos originais. Se isso acontecesse, a integridade das evidências forenses seria comprometida.

Geralmente, a coleta de evidências faz parte do processo de resposta a incidentes. Ela fornece evidências aos agentes públicos caso a organização queira entrar com uma ação judicial contra os invasores. A evidência forense é superútil para dar detalhes do ataque à comunidade de segurança. Com ela, outras equipes de segurança ficam a par de novas ameaças e dá a elas a chance de se defenderem melhor. Além disso, é muito importante envolver membros de sua equipe jurídica nos planos de gerenciamento de incidentes.

Como um incidente pode ter consequências legais para a empresa, é preciso ter um advogado disponível como consultar sobre os aspectos jurídicos da investigação. Isso é vital para evitar complicações ou problemas de responsabilidade. O pessoal da equipe de relações públicas também deve se envolver, já que esses incidentes impactar a reputação da empresa. Tem outra parte da fase de limpeza e recuperação que merece destaque. Teremos que usar informações da análise para evitar novas invasões ou infecções.

Primeiro, determinamos o ponto de entrada para descobrir como o invasor entrou ou qual vulnerabilidade o malware explorou. É preciso fazer isso junto com a limpeza. Se você remover a infecção por malware sem também corrigir a vulnerabilidade exploradas, os sistemas podem ser reinfectados logo depois da limpeza.

Se um sistema crítico for comprometido, pode ser complicado remediar por conta da inatividade durante a remediação e recuperação. Os logs precisam ser auditados para se determinar o que o invasor fez enquanto teve acesso ao sistema. Eles também mostram que dados o invasor acessou. Os sistemas devem passar por um exame para garantir que não haja backdoor instalada ou malware implantado no sistema. Dependendo da gravidade da violação ou infecção, pode ser necessário reconstruir o sistema do zero.

A limpeza normalmente restaura um ponto de backup para uma boa configuração conhecida. Arquivos do sistema infectados ou corrompidos são restaurados com cópias boas e conhecidas. Às vezes, a limpeza pode ser muito simples e rápida.

Se um site ficou desfigurado, o invasor pode ter carregado um arquivo HTML desfigurado e direcionado o servidor web no novo arquivo. A alteração e exclusão de um arquivo de configuração do arquivo HTML do invasor não consegue desfazer as mudanças. Mesmo assim, é preciso trabalhar para determinar como o invasor obteve o acesso. Essa vulnerabilidade deve ser eliminada para evitar futuros ataques.

Depois de descobertos e removidos todos os vestígios do ataque e as vulnerabilidades conhecidas, você pode seguir para o último passo. É nele que os sistemas devem ser testados amplamente para confirmar que o funcionamento normal foi restaurado.

Normalmente, os sistemas afetados ainda seriam vigiados de perto, às vezes com monitoramento e registro detalhados. O objetivo é detectar novos sinais de invasão caso algo tenha passado despercebido durante a limpeza.

Além disso, é possível que o invasor tente atacar o mesmo alvo novamente. Há uma chance muito alta de ele usar a mesma metodologia de ataque ou parecida em outros alvos na sua rede. É importante agregar o conhecimento que você adquiriu com os incidentes às suas defesas de segurança gerais. Atualize regras de firewall e ACLs se descobrir uma exposição no meio de uma investigação. Crie novas definições e regras para sistemas de detecção de invasão que possam identificar novos sinais do mesmo ataque.

**Fique se olho e sempre em posição para proteger seu sistema de ataques. Lembre-se que, em algum momento, algum tipo de violação de segurança vai acontecer. Só mantenha a calma e execute seu plano para combater a violação.**
