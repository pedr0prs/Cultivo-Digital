# Criptografia

O assunto **criptografia, ou ocultar mensagens de potenciais inimigos, existe há milhares de anos.** Ele evoluiu muito com o advento da tecnologia moderna, dos computadores e das telecomunicações. A criptografia é o ato de pegar uma mensagem, chamado de texto simples, e aplicar uma operação, chamada de cifra, para que você receba uma mensagem ilegível e embaralhada depois, chamada de **texto cifrado.**

O processo inverso de pegar a mensagem distorcida e transformá-la de volta em texto simples é chamado de descriptografia. **A cifra é feita de dois componentes, o algoritmo de criptografia e a chave.** O algoritmo de criptografia é a lógica ou processo subjacente que é usado para converter o texto simples em texto cifrado. Esses algoritmos são geralmente operações matemáticas muito complexas, Mas há também alguns algoritmos muito básicos que analisar e que não exigem necessariamente um PhD em matemática para serem entendidos.

O outro componente crucial da cifra é a **chave, que introduz algo único na cifra.** Sem a chave, qualquer pessoa que use o mesmo algoritmo consegue decodificar a mensagem e não haveria nenhum sigilo de fato.

Resumindo, primeiro você escolhe o algoritmo de criptografia que você quer usar para codificar sua mensagem, depois você escolhe uma chave. Agora você tem uma cifra, na qual você pode passar sua mensagem de texto simples e obter um texto cifrado criptografado pronto para ser enviado para o mundo, segura e protegida contra olhares maldosos.

Esse conceito geral é chamado de segurança através da obscuridade, que basicamente significa que se ninguém souber qual algoritmo você está usando ou nossa prática geral de segurança, estaremos a salvo de invasores. É como esconder a chave da sua casa embaixo do tapete, contanto que o ladrão não saiba que você esconde a chave extra debaixo do tapete, você está seguro. Mas quando essa informação é descoberta, toda a segurança é perdida, juntamente com seus objetos de valor.

Então, claramente, a segurança através obscuridade não é algo em que você deve confiar para proteger comunicações ou sistemas. Este conceito geral de criptografia é chamado de princípio de Kerchoff. Este princípio afirma que um sistema criptográfico ou um conjunto de algoritmos para a geração de chaves e operações de criptografia e decodificação em um serviço criptográfico deve permanecer seguro, mesmo que todas as partes do sistema sejam conhecidas, exceto a chave. Isso significa que mesmo que seu inimigo saiba o algoritmo de criptografia que você usa para proteger seus dados, ele não conseguirá recuperar o texto simples a partir de um texto cifrado interceptado. Você também pode ouvir este princípio como a máxima de Shannon ou como o inimigo conhece o sistema. As implicações são as mesmas.

O sistema deve permanecer seguro, mesmo que seu adversário saiba exatamente o tipo de sistema de criptografia que você está empregando, contanto que suas chaves permaneçam seguras. Já definimos a encriptação, mas a disciplina que abrange a prática de codificar e esconder mensagens contra terceiros é chamada de criptografia. O estudo desta prática é chamada de criptologia.

O oposto, procurar mensagens ocultas ou tentar decifrar mensagens codificadas, é chamado de criptoanálise. Estes dois campos têm evoluído ao longo da história com novas cifras e cripto-sistemas sendo desenvolvidos à medida que os antigos têm sido violados ou considerados vulneráveis.

Uma das primeiras descrições registradas da criptoanálise foi feita por um matemático árabe do século IX, quem descreveu um método de análise de frequência para resolver mensagens codificadas. A análise de frequência é a prática de estudar a frequência com que as letras aparecem no texto cifrado. A premissa por trás desse tipo de análise é a de que, em idiomas escritos, certas letras aparecem mais frequentemente que outras e algumas letras são mais comumente agrupadas do que outras.

Durante a Primeira Guerra Mundial e a Segunda Guerra Mundial,  a criptografia e a criptoanálise tiveram um papel muito importante. Houve um afastamento da análise linguística e de frequência e uma aproximação das análises mais baseadas na matemática. Isto ocorreu em razão da criação de cifras mais sofisticadas. Um grande divisor de águas na criptoanálise ocorreu durante a Segunda Guerra Mundial, quando os aliados dos EUA começaram a incorporar matemática sofisticada para desvendar esquemas de criptografia de acesso. Foi aí que houve o primeiro uso da tecnologia da automação aplicada à criptoanálise na Inglaterra, no Bletchley Park.

O primeiro computador digital programável, chamado Colossus, foi desenvolvido para ajudar nesse esforço. Os primeiros computadores foram usados para desvendar criptografias, e isso abriu as portas para um enorme salto no desenvolvimento de sistemas criptográficos ainda mais sofisticados e complexos.

A esteganografia é uma prática conhecida, mas é bastante diferente da criptografia. É a prática de esconder informações dos observadores, sem codificá-las. Pense em escrever uma mensagem usando tinta invisível. A mensagem está em texto simples e não é necessário decodificá-la para ler o texto, o texto só está oculto. A tinta é invisível e fica visível por meio de um mecanismo conhecido pelo destinatário.

Técnicas esteganográficas modernas incluem a adição de mensagens e até arquivos dentro de outros arquivos, como imagens ou vídeos. Para um observador casual, só uma foto de um filhote fofinho seria vista. Mas se você colocar essa imagem em um software de esteganografia, ele extrairia uma mensagem escondida dentro do arquivo de imagem. O que é muito divertido é aprender sobre essas coisas de espião.

## Criptografia simétrica

Quando falamos do princípio de Kerchhoff anteriormente, você se lembra de qual componente da cifra é crucial para manter o sigilo? É isso mesmo. A chave deve ser mantida em privacidade para garantir que algum interceptador não consiga decodificar as mensagens criptografadas. Neste cenário, estamos pressupondo que o algoritmo usado é aquele que chamamos de algoritmo de chave simétrica. Esses tipos de algoritmos de criptografia são chamados de simétricos porque usam a mesma chave para criptografar e descriptografar as mensagens.

São as cifras de bloco ou cifras de fluxo. A diferença está no modo como as cifras operam no texto simples para serem criptografadas. Uma cifra de fluxo, como o nome indica, pega um fluxo de informações e criptografa esse fluxo usando um caractere ou um dígito por vez, resultando em um caractere ou dígito criptografado por vez. Portanto, há uma relação de um para um entre os dados originais e os dados criptografados.

A outra categoria de cifras simétricas é a cifra de bloco. A cifra coleta os dados, coloca-os em um bloco de dados de tamanho fixo e codifica todo esse bloco enquanto unidade. Se os dados a serem criptografados forem menores que o bloco, o espaço adicional será preenchido para que o texto simples se encaixe nos blocos uniformemente.

Agora, em linhas gerais, as cifras de fluxo são mais rápidas e menos complexas de implementar, mas podem ser menos seguras que as cifras de bloco. Se a geração e manipulação das chaves não for feita corretamente, se a mesma chave for usada para criptografar dados duas ou mais vezes, é possível quebrar a cifra e recuperar o texto simples. Para evitar a reutilização de chaves, usa-se o vetor de inicialização, ou VI. Trata-se de dados aleatórios que são integrados à chave de criptografia e o resultado passa a ser usado para criptografar os dados.

### Algoritmos de criptografia simétricos

Um dos primeiros padrões de criptografia é o **DES, que significa padrão de criptografia de dados.** O DES foi projetado na década de 1970 pela IBM, com participação da Agência de Segurança Nacional dos EUA. O DES foi adotado como FIPS oficial, ou seja, padrão federal de processamento de informações, nos EUA. Isso significa que o DES foi adotado como padrão federal para a criptografia e a proteção dos dados do governo. O DES é uma cifra de bloco simétrica que usa tamanhos de chave de 64 bits e opera em blocos de 64 bits. Embora o tamanho da chave seja tecnicamente de 64 bits, são usados apenas 8 bits para verificação de paridade, uma forma simples de verificação de erros. Isso significa que o comprimento real da chave do DES é de apenas 56 bits.

Em algoritmos de criptografia simétrica, a mesma chave é usada para criptografar e descriptografar.
A chave é a peça única que protege seus dados e a chave simétrica deve ser mantida em segredo para garantir a confidencialidade dos dados protegidos. O tamanho da chave, definido em bits, é o número total de bits ou dados que abrangem a chave de criptografia. Então dá para pensar no tamanho da chave como o limite máximo para o total de chaves possíveis para determinado algoritmo de criptografia. O comprimento de chave é muito importante em criptografia, pois ele define a força máxima potencial do sistema.

Um método de ataque é tentar adivinhar a chave e ver se a mensagem se decodifica corretamente. Chamamos isso de ataque de força bruta. Os comprimentos de chave mais longos protegem contra este tipo de ataque.

Vamos pegar a chave DES como exemplo. 64 bits de comprimento menos os 8 bits de paridade nos dá um comprimento de chave de 56 bits. Isso significa que há, no máximo, 2 elevado à potência 56, ou 72 quatrilhões de chaves possíveis. Parece um número gigantes de chaves, e na década de 1970, foi. Mas como a tecnologia avançou e os computadores ficaram mais rápidos e eficientes, as chaves de 64 bits passaram a ser muito pequenas. O que antes eram apenas ataques teóricos em um tamanho de chave tornou-se realidade em 1998, quando a FEP, Electronic Frontier Foundation, descriptografou uma mensagem criptografada em DES em apenas 56 horas. Por causa da fraqueza inerente ao tamanho pequeno da chave DES, foram projetados e propostos algoritmos de substituição. Várias novidades apareceram nos anos 80 e 90. Muitas mantiveram o tamanho de bloco de 64 bits, mas usaram um tamanho de chave maior, facilitando a substituição do DES.

Em 1997, o NIST, National Institute of Standards and Technology, quis substituir o DES por um novo algoritmo, e em 2001, adotou o AES, Advanced Encryption Standard, depois de uma competição internacional. O AES também é a primeira e única codificação pública aprovada para uso com informações secretas da Agência de Segurança Nacional dos Estados Unidos. O AES também é uma cifra de bloco simétrica semelhante ao DES, que foi substituído. Mas o AES usa blocos de 128 bits, duas vezes o tamanho dos blocos do DES, e suporta comprimentos de chave de 128 bits, 192 bits ou 256 bits.

Por causa do grande tamanho da chave, os ataques de força bruta ao AES são apenas teóricos, porque o poder de computação necessário (ou o tempo necessário utilizando-se a tecnologia moderna) excede qualquer coisa viável atualmente. Devo ressaltar que esses algoritmos são os designs gerais das cifras em si. Esses designs devem ser implementados em softwares ou hardwares antes que as funções de criptografia possam ser aplicadas e colocadas em uso.

Algo importante a se ter em mente ao considerar os vários algoritmos de criptografia é a velocidade e a facilidade de implementação. Idealmente, um algoritmo não pode ser excessivamente difícil de implementar porque uma implementação complicada pode levar a erros e perdas potenciais na segurança em razão de bugs introduzidos na implementação. A velocidade é importante porque, às vezes, os dados serão criptografados através de várias passagens na cifra. Esses tipos de operações de criptografia acabam sendo realizadas por dispositivos, então quanto mais rápido eles forem, menos impacto haverá no sistema, o que é melhor. É por isso que algumas plataformas implementam esses algoritmos criptográficos no hardware para acelerar os processos e remover cargas da CPU.

Por exemplo, as CPUs modernas da Intel ou AMD têm instruções de AES embutidas nas próprias CPUs. Isso permite uma velocidade computacional muito maior e mais eficiência quando se trabalha com cargas criptográficas.

Há algoritmo que já foi amplamente utilizado, mas que comprovadamente é fraco e não recomendamos seu uso. O RC4, ou Rivest Cipher 4, é uma cifra de fluxo simétrico que gerou ampla adoção por sua simplicidade e rapidez. O RC4 suporta tamanhos de chave de 40 bits a 2.048 bits, então a fraqueza do RC4 não se dá por ataques de força bruta, mas a própria cifra tem fraquezas e vulnerabilidades inerentes que não são só teóricas, há muitos exemplos que comprovam a quebra do RC4. Um exemplo recente de quebra do RC4 é o ataque RC4 NOMORE. Este ataque foi conseguiu recuperar um cookie de autenticação de uma conexão criptografada por TLS em apenas 52 horas. Como é um ataque à própria cifra RC4, qualquer protocolo que usa esta cifra fica potencialmente vulnerável ao ataque. Mesmo assim, o RC4 foi usado em um grupo de protocolos populares de criptografia, como o WEP, para criptografia sem fio, e WPA, o sucessor do WEP. Também foi usado no SSL e no TLS até 2015, quando o RC4 foi excluído de todas as versões do TLS por causa de vulnerabilidades inerentes. Por esse motivo, a maioria dos principais navegadores web retiraram o suporte ao RC4, juntamente com todas as versões do SSL e usam o TLS no lugar. A configuração segura preferível é o TLS 1.2 com o AES GCM, um modo específico de operação para a cifra de bloco AES que a transforma em uma cifra de fluxo.

O GCM, ou Galois/Counter Mode, trabalha tomando um valor seed aleatório, incrementando-o e criptografando o valor, criando blocos sequencialmente numerados de textos cifrados. Os textos cifrados são incorporados ao texto simples para criptografia. O GCM é muito comum porque sua segurança se baseia em criptografia AES, pelo seu desempenho e pelo fato de poder ser executado em paralelo com grande eficiência.

Agora que falamos de criptografia simétrica e vimos alguns exemplos de algoritmos de criptografia simétrica, quais são os benefícios ou desvantagens de se usar a criptografia simétrica? Por causa da natureza da criptografia simétrica e do processo de decodificação, é relativamente fácil implementá-la e mantê-la. Trata-se de um segredo compartilhado que você precisa manter seguro. Pense na senha do Wi-Fi da sua casa. Há um segredo compartilhado: a senha do seu Wi-Fi, que permite que todos os dispositivos se conectem a ele. Os algoritmos simétricos também são muito rápidos e eficientes na criptografia e descriptografia de grandes volumes de dados. Então, quais são as desvantagens de usar a criptografia simétrica? Embora de ter um segredo compartilhado para criptografar e descriptografar pareça cômodo a princípio, algumas complicações podem surgir.

## Criptografia assimétrica

Lembra-se da razão pela qual as cifras simétricas são chamadas assim? A mesma chave é usada para criptografar e descriptografar. Isso vai de encontro aos sistemas de criptografia assimétrica porque, como o nome indica, chaves diferentes são usadas para criptografar e descriptografar.

Os três conceitos que um cripto-sistema assimétrico nos oferece são **confidencialidade, autenticidade e não-repúdio.**

- A confidencialidade é concedida através do mecanismo de criptografia-descriptografia, pois nossos dados criptografados são mantidos confidenciais e secretos contra terceiros não autorizados.
- A autenticidade é garantida pelo mecanismo de assinatura digital, pois é possível autenticar ou validar que a mensagem não tenha sido adulterada.
- Não repúdio significa que o autor da mensagem não pode contestar a origem dessa mensagem.

A criptografia assimétrica permite uma comunicação segura em um canal não confiável, mas com a criptografia simétrica, precisamos comunicar com segurança o segredo ou a chave com a outra pessoa. Se for esse o caso, parece que a criptografia assimétrica é melhor, certo? Bem, mais ou menos. Embora a criptografia assimétrica funcione muito bem em ambientes não confiáveis, ela é computacionalmente mais cara e complexa.

Por outro lado, os algoritmos de criptografia simétrica são mais rápidos e mais eficientes na criptografia de grandes quantidades de dados. Na verdade, o que muitos esquemas de comunicações seguras fazem é aproveitar os benefícios relativos de ambos os tipos de criptografia usando os dois para finalidades diferentes. O algoritmo de criptografia assimétrica é escolhido como mecanismo de troca de chaves ou cifras. Isso significa que a chave de criptografia simétrica ou o segredo compartilhado é transmitido com segurança para a outra pessoa usando a criptografia assimétrica para proteger o segredo compartilhado. Depois que o segredo compartilhado é recebido, os dados podem ser enviados rapidamente e de forma eficiente e segura usando-se uma cifra de criptografia assimétrica.

criptografia assimétrica: os MACs, ou códigos de autenticação de mensagens, não devem ser confundido com os endereços de controle de acesso à mídia, ou endereços MAC. O MAC é uma informação que permite a autenticação de uma mensagem recebida, garantindo que a mensagem veio do suposto remetente e não de terceiro disfarçado. Ele também garante que a mensagem não foi modificada de nenhuma forma a fim de conferir integridade aos dados. Parece muito com as assinaturas digitais que usam criptografia de chave pública, não é? Embora seja muito semelhante, ele difere um pouco porque a chave secreta que é usada para gerar o MAC é a mesma usada para verificá-lo. Neste sentido, ele é semelhante ao sistema de criptografia simétrica e a chave secreta deve ser acordada por todas as partes da comunicação de antemão ou compartilhadas de alguma forma segura.

Cabe mencionar um tipo comum e seguro de MAC chamado **HMAC, ou código de autenticação de mensagem de hash com chave.** O HMAC usa uma função hash criptográfica juntamente com uma chave secreta para gerar um MAC. Qualquer função hash criptográfica pode ser usada, como Sha-1 ou MD5, e a força ou segurança do MAC depende da segurança subjacente da função hash criptográfica usada. O MAC é enviado junto com a mensagem que está sendo verificada. O Mac é verificado pelo receptor executando a mesma operação na mensagem recebida, depois comparando o MAC calculado com o recebido com a mensagem. Se os MACs forem iguais, a mensagem é autenticada.

Existem também MACs baseados em cifras de criptografia simétricas, de bloco ou de fluxo, como o DES ou o AES, que são chamados de CMACs, ou códigos de autenticação de mensagens baseados em cifras. O processo é semelhante ao HMAC, mas em vez de usar uma função hash, uma cifra simétrica com chaves compartilhadas são usadas para criptografar a mensagem e o resultado é usado como MAC. Um exemplo específico e comum de CMAC, embora ligeiramente diferente, é o CBC-MAC, ou códigos de autenticação de mensagem com encadeamento de cifras de bloco. O CBC-MAC é um mecanismo para construir MACs usando cifras de bloco. Ele funciona tomando uma mensagem e criptografando-a com uma cifra de bloco no modo CBC. O modo CBC é um modo de operação para cifras de bloco que incorpora um texto de bloco criptografado anteriormente no texto simples do próximo bloco. Então, ele cria uma cadeia de blocos criptografados que exigem a cadeia completa para decifrar. Esta cadeia de blocos criptografados interdependentemente significa que qualquer modificação no texto simples resultará em um resultado final diferente no fim da cadeia, garantindo a integridade da mensagem.

### Algoritmos de criptografia assimétricos

Um dos primeiros sistemas de criptografia assimétrica desenvolvidos foi o **RSA**, iniciais dos três co-inventores. Ron Rivest, Adi Shamir e Leonard Adleman. Este sistema de criptografia foi patenteado em 1983 e foi liberado para o domínio público pela RSA Security no ano 2000. O sistema RSA especifica mecanismos para geração e distribuição de chaves, juntamente com as operações de criptografia e descriptografia usando essas chaves.

É importante saber que o processo de geração de chaves depende da escolha de dois números primos aleatórios e geralmente muito altos. O DSA, ou algoritmo de assinatura digital, é outro exemplo de sistema de criptografia assimétrica, embora seja usado para assinar e verificar dados. Ele foi patenteado em 1991 e faz parte do padrão de processamento de informações do Governo Federal dos EUA.

Parecida com o RSA, a especificação trata do processo de geração de chaves, juntamente com a assinatura e verificação de dados usando pares de chaves. É importante ressaltar que a segurança desse sistema depende da escolha de um valor seed aleatório que é incorporado ao processo de assinatura. Se este valor vazar ou puder ser inferido ou se o número primo não for de fato aleatório, é possível que algum invasor recupere a chave privada.

Outro algoritmo popular de troca de chaves é o DH, ou Diffie-Hellman, que leva o nome de seus co-inventores.
Este algoritmo foi projetado exclusivamente para troca de chaves, embora tenha havido esforços para adaptá-lo para fins de criptografia. Ele também é usado no sistema PKI, ou sistem de infraestrutura de chaves públicas.

A criptografia de curva elíptica, ou ECC, é um sistema de criptografia de chave pública que usa a estrutura algébrica de curvas elípticas em campos finitos para gerar chaves seguras. O benefício dos sistemas de criptografia baseados em curva elíptica é que eles são capazes de alcançar uma segurança semelhante àquela dos sistemas de chave pública tradicionais com tamanhos de chave menores. Então, por exemplo, uma chave de curva elíptica de 256 bits seria comparável a uma chave RSA de 3.072 bits. Isso é muito benéfico, pois reduz a quantidade de dados necessários para armazenamento e transmissão ao lidar com as chaves. Tanto a Diffie-Hellman quanto a DSA têm variantes de curvas elípticas, chamadas de ECDH e ECDSA, respectivamente. O US NEST recomenda o uso de criptografia com curva elíptica e a NSA permite seu uso para proteger dados secretos com chaves de curva elíptica de 384 bits. Mas a NSA já demonstrou preocupação com a possibilidade de a criptografia com curva elíptica ser vulnerável a ataques de computação quântica à medida que a tecnologia de computação quântica evolui e amadurece.
